# Onboarding, Progressive Disclosure, UX Writing, and Analytics Testing Guide

## Overview

This document outlines the comprehensive testing strategy for the new Onboarding, Progressive Disclosure, UX Writing, and Analytics features implemented in Africa Business Bridge.

## Testing Phases

### Phase 1: Unit Testing

#### Frontend Components

**OnboardingDashboard Component**

```javascript
// Test: Component renders correctly
test('OnboardingDashboard renders with suggested partners', () => {
  const mockPartners = [
    { id: 1, company_name: 'Partner 1', match_score: 90 },
    { id: 2, company_name: 'Partner 2', match_score: 85 },
  ];
  const { getByText } = render(\n    <OnboardingDashboard\n      suggestedPartners={mockPartners}\n      onPartnerSelect={jest.fn()}\n      onTutorialComplete={jest.fn()}\n    />\n  );\n  expect(getByText('Partner 1')).toBeInTheDocument();\n});\n\n// Test: onTutorialComplete callback is called\ntest('onTutorialComplete is called when tutorial is completed', () => {\n  const onComplete = jest.fn();\n  const { getByText } = render(\n    <OnboardingDashboard\n      suggestedPartners={[]}\n      onPartnerSelect={jest.fn()}\n      onTutorialComplete={onComplete}\n    />\n  );\n  fireEvent.click(getByText('Completa Tutorial'));\n  expect(onComplete).toHaveBeenCalled();\n});\n```\n\n**ProgressiveDisclosure Component**\n\n```javascript\n// Test: Features are locked initially\ntest('Features are locked until user actions are completed', () => {\n  const { getByText } = render(\n    <ProgressiveDisclosure\n      userActions={{\n        first_message_sent: false,\n        meeting_completed: false,\n      }}\n      onFeatureUnlock={jest.fn()}\n    />\n  );\n  expect(getByText('Bloccato')).toBeInTheDocument();\n});\n\n// Test: Features unlock after user actions\ntest('Features unlock after user actions', () => {\n  const onUnlock = jest.fn();\n  const { getByText } = render(\n    <ProgressiveDisclosure\n      userActions={{\n        first_message_sent: true,\n        meeting_completed: false,\n      }}\n      onFeatureUnlock={onUnlock}\n    />\n  );\n  expect(getByText('Sbloccato')).toBeInTheDocument();\n});\n```\n\n**AnalyticsDashboard Component**\n\n```javascript\n// Test: Analytics data is fetched and displayed\ntest('Analytics data is fetched and displayed', async () => {\n  const mockData = {\n    total_new_users: 150,\n    completion_rate: 75,\n    users_sent_first_message: 112,\n  };\n  \n  global.fetch = jest.fn(() =>\n    Promise.resolve({\n      json: () => Promise.resolve(mockData),\n    })\n  );\n  \n  const { getByText } = render(\n    <AnalyticsDashboard apiUrl=\"http://localhost:8000\" />\n  );\n  \n  await waitFor(() => {\n    expect(getByText('150')).toBeInTheDocument();\n    expect(getByText('75%')).toBeInTheDocument();\n  });\n});\n```\n\n#### Backend Services\n\n**Analytics Service**\n\n```python\n# Test: Calculate onboarding metrics\ndef test_calculate_onboarding_metrics():\n    from app.services.analytics_service import AnalyticsService\n    \n    service = AnalyticsService()\n    metrics = service.calculate_onboarding_metrics(days=7)\n    \n    assert 'total_new_users' in metrics\n    assert 'completion_rate' in metrics\n    assert 'users_sent_first_message' in metrics\n    assert metrics['completion_rate'] >= 0 and metrics['completion_rate'] <= 100\n\n# Test: Calculate conversion funnel\ndef test_calculate_conversion_funnel():\n    from app.services.analytics_service import AnalyticsService\n    \n    service = AnalyticsService()\n    funnel = service.calculate_conversion_funnel(days=7)\n    \n    assert 'funnel_stages' in funnel\n    assert len(funnel['funnel_stages']) > 0\n    assert all('stage' in stage and 'count' in stage for stage in funnel['funnel_stages'])\n\n# Test: Identify drop-off points\ndef test_identify_drop_off_points():\n    from app.services.analytics_service import AnalyticsService\n    \n    service = AnalyticsService()\n    drop_offs = service.identify_drop_off_points(days=7, threshold=30)\n    \n    assert isinstance(drop_offs, list)\n    assert all('from_stage' in point and 'to_stage' in point for point in drop_offs)\n```\n\n### Phase 2: Integration Testing\n\n#### API Integration Tests\n\n**Analytics API Endpoints**\n\n```bash\n# Test: GET /analytics/onboarding-metrics\ncurl -X GET \"http://localhost:8000/api/v1/analytics/onboarding-metrics?days=7\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\"\n\n# Expected Response:\n{\n  \"total_new_users\": 150,\n  \"completion_rate\": 75.5,\n  \"users_sent_first_message\": 112,\n  \"period_days\": 7\n}\n\n# Test: GET /analytics/conversion-funnel\ncurl -X GET \"http://localhost:8000/api/v1/analytics/conversion-funnel?days=7\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\"\n\n# Expected Response:\n{\n  \"funnel_stages\": [\n    {\"stage\": \"Registered\", \"count\": 150, \"percentage\": 100},\n    {\"stage\": \"Profile Completed\", \"count\": 120, \"percentage\": 80},\n    {\"stage\": \"First Message Sent\", \"count\": 112, \"percentage\": 74.67},\n    {\"stage\": \"Meeting Scheduled\", \"count\": 45, \"percentage\": 30},\n    {\"stage\": \"Contract Signed\", \"count\": 12, \"percentage\": 8}\n  ]\n}\n\n# Test: GET /analytics/drop-off-points\ncurl -X GET \"http://localhost:8000/api/v1/analytics/drop-off-points?days=7&threshold=30\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\"\n\n# Expected Response:\n[\n  {\n    \"from_stage\": \"Profile Completed\",\n    \"to_stage\": \"First Message Sent\",\n    \"drop_off_percentage\": 6.67,\n    \"users_lost\": 8\n  },\n  {\n    \"from_stage\": \"First Message Sent\",\n    \"to_stage\": \"Meeting Scheduled\",\n    \"drop_off_percentage\": 59.82,\n    \"users_lost\": 67\n  }\n]\n```\n\n#### Frontend-Backend Integration\n\n```javascript\n// Test: Onboarding flow triggers analytics events\ntest('Onboarding flow triggers analytics events', async () => {\n  const mockTrackEvent = jest.fn();\n  \n  const { getByText } = render(\n    <OnboardingDashboard\n      suggestedPartners={mockPartners}\n      onPartnerSelect={mockTrackEvent}\n      onTutorialComplete={mockTrackEvent}\n    />\n  );\n  \n  fireEvent.click(getByText('Partner 1'));\n  expect(mockTrackEvent).toHaveBeenCalledWith('partner_viewed', { partner_id: 1 });\n  \n  fireEvent.click(getByText('Completa Tutorial'));\n  expect(mockTrackEvent).toHaveBeenCalledWith('onboarding_completed');\n});\n```\n\n### Phase 3: End-to-End (E2E) Testing\n\n#### Cypress Tests\n\n```javascript\n// cypress/e2e/onboarding.cy.js\n\ndescribe('Onboarding Flow', () => {\n  beforeEach(() => {\n    cy.visit('http://localhost:3000/dashboard');\n    cy.login('test@example.com', 'password');\n  });\n\n  it('should display onboarding dashboard for new users', () => {\n    cy.get('.onboarding-dashboard').should('be.visible');\n    cy.get('.suggested-partners').should('have.length.greaterThan', 0);\n  });\n\n  it('should navigate through onboarding steps', () => {\n    cy.get('[data-testid=\"partner-card\"]').first().click();\n    cy.get('[data-testid=\"partner-details\"]').should('be.visible');\n    \n    cy.get('[data-testid=\"send-message-btn\"]').click();\n    cy.get('[data-testid=\"message-input\"]').type('Hello, I\\'m interested in partnership');\n    cy.get('[data-testid=\"send-btn\"]').click();\n    \n    cy.get('[data-testid=\"onboarding-complete-btn\"]').click();\n    cy.get('.onboarding-dashboard').should('not.exist');\n  });\n\n  it('should unlock features progressively', () => {\n    // Send first message\n    cy.get('[data-testid=\"send-message-btn\"]').click();\n    cy.get('[data-testid=\"message-input\"]').type('Hello');\n    cy.get('[data-testid=\"send-btn\"]').click();\n    \n    // Check if calendar is unlocked\n    cy.get('[data-testid=\"calendar-feature\"]').should('not.have.class', 'locked');\n  });\n});\n\n// cypress/e2e/analytics.cy.js\n\ndescribe('Analytics Dashboard', () => {\n  beforeEach(() => {\n    cy.visit('http://localhost:3000/analytics');\n    cy.login('admin@example.com', 'password');\n  });\n\n  it('should display analytics metrics', () => {\n    cy.get('.metric-card').should('have.length', 3);\n    cy.get('[data-testid=\"new-users-metric\"]').should('contain', 'Nuovi Utenti');\n  });\n\n  it('should display conversion funnel', () => {\n    cy.get('.funnel-container').should('be.visible');\n    cy.get('.funnel-stage-detail').should('have.length.greaterThan', 0);\n  });\n\n  it('should filter metrics by period', () => {\n    cy.get('[data-testid=\"period-selector\"]').select('30');\n    cy.get('.metric-value').should('be.visible');\n  });\n\n  it('should display and resolve alerts', () => {\n    cy.get('.alert-card').should('have.length.greaterThan', 0);\n    cy.get('[data-testid=\"resolve-alert-btn\"]').first().click();\n    cy.get('.alert-card').should('have.length.lessThan', 2);\n  });\n});\n```\n\n### Phase 4: Manual Testing Checklist\n\n#### Onboarding Experience\n\n- [ ] New PMI users see the onboarding dashboard on first login\n- [ ] Suggested partners are displayed with correct match scores\n- [ ] Clicking on a partner shows detailed profile information\n- [ ] User can send a message to a partner\n- [ ] Completing the tutorial marks onboarding as complete\n- [ ] Onboarding dashboard is hidden after completion\n- [ ] User can skip onboarding (if applicable)\n\n#### Progressive Disclosure\n\n- [ ] All features are locked initially (except basic ones)\n- [ ] Sending first message unlocks calendar feature\n- [ ] Completing a meeting unlocks blockchain contracts\n- [ ] Signing a contract unlocks order management\n- [ ] Creating an order milestone unlocks logistics\n- [ ] Locked features show clear unlock conditions\n- [ ] Unlock notifications are displayed to the user\n\n#### UX Writing\n\n- [ ] All navigation labels are value-oriented (not technical)\n- [ ] Tooltips appear on hover and provide clear benefits\n- [ ] Success messages are encouraging and action-oriented\n- [ ] Error messages are clear and suggest solutions\n- [ ] CTA buttons use action-oriented language\n- [ ] Onboarding messages guide users step-by-step\n\n#### Analytics Dashboard\n\n- [ ] Metrics are calculated correctly for different periods\n- [ ] Conversion funnel shows correct percentages\n- [ ] Drop-off points are identified accurately\n- [ ] Alerts are triggered when thresholds are exceeded\n- [ ] Period selector updates all metrics\n- [ ] Charts are responsive and readable on mobile\n- [ ] Data is updated in real-time (or at specified intervals)\n\n### Phase 5: Performance Testing\n\n#### Load Testing\n\n```bash\n# Test analytics API under load\nab -n 1000 -c 10 \"http://localhost:8000/api/v1/analytics/onboarding-metrics?days=7\"\n\n# Expected: Response time < 200ms for 90th percentile\n```\n\n#### Frontend Performance\n\n```javascript\n// Lighthouse audit for Analytics Dashboard\ncy.visit('http://localhost:3000/analytics');\ncy.lighthouse();\n// Expected: Performance > 90, Accessibility > 95\n```\n\n### Phase 6: Security Testing\n\n- [ ] Analytics data is only accessible to authorized users\n- [ ] User actions are properly logged and cannot be tampered with\n- [ ] API endpoints require authentication\n- [ ] CORS is properly configured\n- [ ] User data is encrypted in transit\n- [ ] Rate limiting is applied to analytics endpoints\n\n## Test Coverage Goals\n\n- **Unit Tests**: 80%+ coverage for services and components\n- **Integration Tests**: All API endpoints tested\n- **E2E Tests**: All critical user flows covered\n- **Manual Tests**: All features verified on multiple browsers and devices\n\n## Continuous Integration\n\nAll tests should be run automatically on every commit:\n\n```yaml\n# .github/workflows/test.yml\nname: Tests\non: [push, pull_request]\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: actions/setup-node@v2\n      - run: npm install\n      - run: npm run test:unit\n      - run: npm run test:integration\n      - run: npm run test:e2e\n```\n\n## Reporting\n\nTest results should be reported in:\n\n1. **Coverage Reports**: `coverage/` directory\n2. **Test Results**: GitHub Actions artifacts\n3. **Performance Metrics**: Lighthouse reports\n4. **Analytics**: Dashboard showing test trends over time\n\n## Known Issues and Workarounds\n\n(To be updated as issues are discovered during testing)\n\n## Sign-off\n\n- [ ] All unit tests passing\n- [ ] All integration tests passing\n- [ ] All E2E tests passing\n- [ ] Manual testing checklist completed\n- [ ] Performance targets met\n- [ ] Security review passed\n- [ ] Ready for production deployment\n
